<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}} - Public Board</title>
    <meta name="description" content="{{.description}}">
    <link rel="canonical" href="{{.canonical}}">
    <meta name="robots" content="{{.robots}}">
    <meta property="og:title" content="{{.title}} - Public Board">
    <meta property="og:description" content="{{.description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{.canonical}}">
    <meta property="og:site_name" content="{{.siteName}}">
    <meta property="og:image" content="{{.ogImage}}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{.title}} - Public Board">
    <meta name="twitter:description" content="{{.description}}">
    <meta name="twitter:image" content="{{.ogImage}}">
    <link rel="icon" type="image/png" href="/static/images/boom.png">
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="board-page">
        <header class="dashboard-header">
            <div class="container">
                <div class="dashboard-header-content">
                    <div class="dashboard-logo">
                        <a href="/" class="logo-link">
                            <img src="/static/images/logo-sm.png" alt="Disko" class="logo-image">
                        </a>
                    </div>
                    <div class="user-menu">
                        <span class="version-display">v{{.version}}</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="dashboard-main">
            <div class="container">
                <!-- Board Info Section -->
                <div class="board-info-section">
                    <div class="board-info">
                        <h1 id="board-title">Loading...</h1>
                        <p id="board-description"></p>
                        <div class="public-badge">üåê Public Board</div>
                    </div>
                    <div class="board-actions">
                        <button id="refresh-btn" class="btn btn-secondary">Refresh</button>
                    </div>
                </div>

                <div class="board-container">
                    <!-- Tab Navigation -->
                    <div class="board-tabs">
                        <button id="board-tab" class="tab-button active" data-tab="board">
                            <span class="tab-icon">üìã</span>
                            Board
                            <span id="board-ideas-count" class="tab-count">0</span>
                        </button>
                        <button id="release-tab" class="tab-button" data-tab="release">
                            <span class="tab-icon">üöÄ</span>
                            Release
                            <span id="release-ideas-count" class="tab-count">0</span>
                        </button>
                    </div>

                    <!-- Board View -->
                    <div id="board-view" class="tab-content active">
                        <div class="board-header-info">
                            <h2>Board</h2>
                            <div class="board-count-section">
                                <span id="ideas-count" class="ideas-count">Loading...</span>
                            </div>
                        </div>
                        <div id="drag-drop-board" class="drag-drop-board">
                            <!-- Column layout will be loaded here -->
                            <div class="board-loading">Loading board...</div>
                        </div>
                    </div>

                    <!-- Release View -->
                    <div id="release-view" class="tab-content">
                        <div class="release-header">
                            <h2>Released Ideas</h2>
                            <div class="release-controls">
                                <div class="search-container">
                                    <input type="text" id="release-search" placeholder="Search released ideas..." class="search-input">
                                    <button id="clear-search" class="clear-search-btn" title="Clear search">√ó</button>
                                </div>
                                <div class="sort-container">
                                    <select id="release-sort" class="sort-select">
                                        <option value="created_at:desc">Newest First</option>
                                        <option value="created_at:asc">Oldest First</option>
                                        <option value="name:asc">Name A-Z</option>
                                        <option value="name:desc">Name Z-A</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="release-table-container" class="release-table">
                            <!-- Release table will be loaded here -->
                            <div class="release-loading">Loading released ideas...</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Common JavaScript -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/board-tabs.js"></script>
    <script src="/static/js/drag-drop-board.js"></script>
    <script src="/static/js/release-table.js"></script>
    <script src="/static/js/search-bar.js"></script>
    <script src="/static/js/feedback-widget.js"></script>
    
    <script>
        // Public board data from server
        window.boardData = {
            boardId: '{{.boardID}}',
            isAdmin: false, // Public boards are read-only
            publicLink: '{{.publicLink}}',
            isPublic: true // This is a public board
        };

        // Initialize public board view when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            console.log('[PublicBoardView] DOM loaded, initializing public board view...');
            
            // Initialize drag-drop board for public view (read-only)
            if (window.DragDropBoard) {
                window.dragDropBoard = new DragDropBoard();
                // Override the loadBoard method to use public endpoints
                const originalLoadBoard = window.dragDropBoard.loadBoard;
                window.dragDropBoard.loadBoard = async function() {
                    console.log('[PublicBoardView] Loading public board data...');
                    try {
                        // Use publicLink as the ID parameter for public endpoints
                        const response = await window.api.get(`/boards/${window.boardData.publicLink}/public`);
                        console.log('[PublicBoardView] Board data loaded:', response);
                        
                        if (response) {
                            // Update board title and description
                            const boardTitle = document.getElementById('board-title');
                            const boardDescription = document.getElementById('board-description');
                            
                            if (boardTitle) {
                                boardTitle.textContent = response.name || 'Untitled Board';
                            }
                            
                            if (boardDescription) {
                                boardDescription.textContent = response.description || '';
                            }

                            // Update page title
                            document.title = `${response.name || 'Untitled Board'} - Public Board`;

                            // Load ideas for the board
                            await this.loadIdeas();
                        }
                    } catch (error) {
                        console.error('[PublicBoardView] Failed to load board data:', error);
                        this.showErrorMessage('Failed to load board data. Please try again.');
                    }
                };

                // Override the loadIdeas method to use public endpoints
                const originalLoadIdeas = window.dragDropBoard.loadIdeas;
                window.dragDropBoard.loadIdeas = async function() {
                    console.log('[PublicBoardView] Loading ideas for public board...');
                    try {
                        // Use publicLink as the ID parameter for public endpoints
                        const response = await window.api.get(`/boards/${window.boardData.publicLink}/ideas/public`);
                        console.log('[PublicBoardView] Ideas loaded:', response);
                        
                        if (response && response.ideas) {
                            this.ideas = response.ideas;
                            this.renderBoard();
                            this.updateIdeasCount();
                        }
                    } catch (error) {
                        console.error('[PublicBoardView] Failed to load ideas:', error);
                        this.showErrorMessage('Failed to load ideas. Please try again.');
                    }
                };

                // Override shouldShowField to show all fields in public view
                window.dragDropBoard.shouldShowField = function(field) {
                    // Show all fields for public boards (read-only)
                    return true;
                };

                // Override makeDraggable to disable drag and drop for public boards
                const originalMakeDraggable = window.dragDropBoard.makeDraggable;
                window.dragDropBoard.makeDraggable = function() {
                    console.log('[PublicBoardView] Drag and drop disabled for public board');
                    // Don't make cards draggable in public view
                };

                // Initialize the board
                window.dragDropBoard.loadBoard();
            }

            // Initialize other components
            if (window.BoardTabs) {
                window.boardTabs = new BoardTabs();
            }

            if (window.ReleaseTable) {
                window.releaseTable = new ReleaseTable();
            }

            // Bind refresh button
            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    console.log('[PublicBoardView] Refresh button clicked');
                    if (window.dragDropBoard) {
                        window.dragDropBoard.loadBoard();
                    }
                });
            }
        });
    </script>
</body>
</html> 